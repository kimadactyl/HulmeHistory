<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Hulme History</title>

    <link href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
    <link href="stylesheets/all.css" rel="stylesheet" type="text/css" />
    <script src="javascripts/all.js" type="text/javascript"></script>
  </head>

  <body class="index">

    <div class="fixed">
      <nav id="primary" class="top-bar" data-topbar role="navigation">
        <ul class="title-area">
          <li class="name">
            <h1><a href="/">Hulme History</a></h1>
          </li>
          <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
          <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
        </ul>

        <section class="top-bar-section">
          <ul class="right">
            <li><a href="/">Map</a></li>
            <li><a href="/archive">Archive</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </section>
      </nav>
    </div>
    <div id="main">
      <div id="map-wrapper">
  <nav id='menu-ui' class='menu-ui'></nav>

  <section id='timeline-section'>
    <div id='timeline'>
      <div id='tl-content'>
        <div id='crossbar'> </div>
        <ol class="decades">
            <li class="decade decade-1850" value="1850">
              <time class="decade">1850</time>
            </li>
            <li class="decade decade-1860" value="1860">
              <time class="decade">1860</time>
                <ol class="events">
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1860-leaf-street-baths-and-wash-house"
                      value="1860">
                      1860</strong>: <strong>Leaf Street Baths and Wash House</strong><br/>
                      Manchester and Salford Baths and Laundries Company establish first bathhouse in Hulme
                  </li>
                </ol>
            </li>
            <li class="decade decade-1870" value="1870">
              <time class="decade">1870</time>
            </li>
            <li class="decade decade-1880" value="1880">
              <time class="decade">1880</time>
                <ol class="events">
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1880-fancy-dress-ball-raid"
                      value="1880">
                      1880</strong>: <strong>Fancy Dress Ball Raid</strong><br/>
                      "One of the foulest orgies to ever disgrace any town": Famous raid on a drag (?) ball in a temperance hall by Det Jerome Caminada
                  </li>
                </ol>
            </li>
            <li class="decade decade-1890" value="1890">
              <time class="decade">1890</time>
            </li>
            <li class="decade decade-1900" value="1900">
              <time class="decade">1900</time>
                <ol class="events">
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1906-pryme-street-baths-and-wash-house"
                      value="1906">
                      1906</strong>: <strong>Pryme Street Baths and Wash House</strong><br/>
                      Second bath and wash house built with laundry and slipper baths only
                  </li>
                </ol>
            </li>
            <li class="decade decade-1910" value="1910">
              <time class="decade">1910</time>
            </li>
            <li class="decade decade-1920" value="1920">
              <time class="decade">1920</time>
            </li>
            <li class="decade decade-1930" value="1930">
              <time class="decade">1930</time>
            </li>
            <li class="decade decade-1940" value="1940">
              <time class="decade">1940</time>
            </li>
            <li class="decade decade-1950" value="1950">
              <time class="decade">1950</time>
            </li>
            <li class="decade decade-1960" value="1960">
              <time class="decade">1960</time>
            </li>
            <li class="decade decade-1970" value="1970">
              <time class="decade">1970</time>
            </li>
            <li class="decade decade-1980" value="1980">
              <time class="decade">1980</time>
                <ol class="events">
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1983-old-pubs-of-hulme"
                      value="1983">
                      1983</strong>: <strong>The Old Pubs of Hulme</strong><br/>
                      Guide to pubs in old Hulme published. "There was also a dancing bear outside the pubs on Chester Road, which per­formed for our pennies"
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1984-the-hulme-project"
                      value="1984">
                      1984</strong>: <strong>The Hulme Project</strong><br/>
                      Workshops held to discuss the future of Hulme with residents
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1985-hulme-tenants-alliance"
                      value="1985">
                      1985</strong>: <strong>Hulme Tenant's Alliance</strong><br/>
                      Umbrella group formed to share information and support on Hulme-wide issues
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1985-second-hulme-conference"
                      value="1985">
                      1985</strong>: <strong>Second Hulme Conference</strong><br/>
                      Conference to discuss future of Hulme at Birley High School
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1985-from-hulme-all-blessings-flow"
                      value="1985">
                      1985</strong>: <strong>From Hulme All Blessings Flow</strong><br/>
                      Memoirs of a Henry Watkin, a Hulme resident published, who grew up around 1900
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1988-housing-defects-in-manchester"
                      value="1988">
                      1988</strong>: <strong>Housing Defects In Manchester</strong><br/>
                      Publication by Manchester City Council detailing the terrible state of their council housing stock, railing at Central Government
                  </li>
                </ol>
            </li>
            <li class="decade decade-1990" value="1990">
              <time class="decade">1990</time>
                <ol class="events">
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1990-homocult"
                      value="1990">
                      1990</strong>: <strong>Homocult</strong><br/>
                      Controversial working class queer artists publish their manifesto
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1990-pig"
                      value="1990">
                      1990</strong>: <strong>P.I.G. (Public Information Gazette)</strong><br/>
                      Local newsletter started by Hulme residents
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1990-hulme-park"
                      value="1991">
                      1991</strong>: <strong>Hulme Park</strong><br/>
                      Park built in Hulme using "design against crime" principles
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1991-views-from-the-crescents"
                      value="1991">
                      1991</strong>: <strong>Views from the Crescents</strong><br/>
                      Publication of a fifteen month project to record peoples experiences of Hulme and their aspirations
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1992-community-planning-workshop"
                      value="1992">
                      1992</strong>: <strong>Community Planning Workshop</strong><br/>
                      Report published on "the new yeart of hulme"
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1992-gaia-92-bloom-arts"
                      value="1992">
                      1992</strong>: <strong>Gaia 92 and bLoOm Arts</strong><br/>
                      Artists' collective formed to introduce art to the Hulme City Challenge and pressure public agencies for more funding
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1992-hulme-city-challenge"
                      value="1992">
                      1992</strong>: <strong>Hulme City Challenge</strong><br/>
                      Manchester City Council submits proposal for transforming Hulme to central government
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1994-hulme-guide-to-development"
                      value="1994">
                      1994</strong>: <strong>Hulme Guide To Development</strong><br/>
                      Hulme Regeneration Ltd. publishes guide to what they learned working on Hulme
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1997-hulme-high-street"
                      value="1997">
                      1997</strong>: <strong>Hulme High Street</strong><br/>
                      Hulme shopping center redeveloped
                  </li>
                  <li class="event item block "
                      lat=""
                      lng=""
                      data="1997-homes-work-for-change"
                      value="1997">
                      1997</strong>: <strong>Homes & Work For Change</strong><br/>
                      Cooperative living and workspace set up, known locally as the Yellowbricks
                  </li>
                </ol>
            </li>
            <li class="decade decade-2000" value="2000">
              <time class="decade">2000</time>
            </li>
            <li class="decade decade-2010" value="2010">
              <time class="decade">2010</time>
            </li>
        </ol>
      </div>
    </div>
    <div id='listholder'>
      <ol class="button-group">
      </ol>
    </div>
  </section>

  <section id='popup-data'>
    <a id='ctl-prev' class='popup-controls popup-controls-left'>&laquo;</a>
    <div id='popup'>
      <div id='cover'>
        <img class="cover" src="">
      </div>
      <div id='popup-wrapper'>
        <div id='popup-header'>
          <h2>
            <span id='popup-year'> </span>
            <span id='popup-title'> </span>
          </h2>
        </div>
        <div id="popup-text">
        </div>
      </div>
    </div>
    <a id='ctl-next' class='popup-controls popup-controls-right'>&raquo;</a>
    <a id='ctl-close' class='popup-controls popup-controls-close'>X</a>
    <a id='ctl-more' class='popup-controls popup-controls-more'>↓</a>
  </section>

  <section id='map'></section>
</div>

<script>
// SET PANNING RANGE HERE
var northeast = L.latLng(53.495634,-2.32168);
var southwest = L.latLng(53.455451,-2.223401);

if(southwest && northeast) {
  bounds = L.latLngBounds(southwest, northeast);
} else {
  bounds = null;
}

var mapopts = {
  center: [53.468,-2.260],
  minZoom: 15,
  zoom:15,
  maxZoon: 19,
  maxBounds: bounds
}

L.mapbox.accessToken = 'pk.eyJ1Ijoia2ltYWRhY3R5bCIsImEiOiJCYzdNTTR3In0.hkjyGpEFYdSPrVp3e717eA';
var map = L.map('map', mapopts);

  // { maxBounds: bounds,
  //   maxZoom:19,
  //   minZoom:11
  // });
var layers = document.getElementById('menu-ui');

// Colour defs
var buildings = "#7FBB71";
var blocks = "#CDCCCC";

// Base map
var old_map = L.mapbox.tileLayer('mapbox.light');
var modern_map = L.mapbox.tileLayer('mapbox.streets');
addLayer(old_map, 'Base Map', 1);

// 1871 map layers
var group1871 = L.layerGroup();
addLayer(group1871, '1871', 2);
// Async load so that the styles work properly for now.
// Later we can edit the style info in the geojson directly.
// $.getJSON('./gis/1871_figure_ground.geojson', function(data) {
  l = L.mapbox.featureLayer('./gis/1871_figure_ground.geojson');
  console.log(l);
  l.addTo(group1871);
  l.setStyle({fillColor: buildings});
// });

// $.getJSON('./gis/1871_blocks.geojson', function(data) {
  l = L.mapbox.featureLayer('./gis/1871_blocks.geojson');
  l.addTo(group1871);
  l.setStyle({fillColor: blocks});
// });


// 1990 map layers
var group1990 = L.layerGroup();
//addLayer(group1990, '1990', 3);

// $.getJSON('./gis/1990_figure_ground.geojson', function(data) {
  l = L.mapbox.featureLayer('./gis/1990_figure_ground.geojson');
  l.addTo(group1990);
  l.setStyle({fillColor: buildings});
// });

// $.getJSON('./gis/1990_blocks.geojson', function(data) {
  l = L.mapbox.featureLayer('./gis/1990_blocks.geojson');
  l.addTo(group1990);
  l.setStyle({fillColor: blocks});
// });

// 2015 layers
var group2015 = L.layerGroup();
//addLayer(group2015, '2015', 4);

//
map.present = group1871;

map.update = function() {
  current_year = parseInt($(".event.active").attr('value'));

  // Pick the appropriate map
  if(current_year < 1970){
    new_map = group1871;
  } else if(current_year < 1994) {
    new_map = group1990;
  } else {
    new_map = group2015;
  }

  // Do we need to change it?
  if(new_map != map.present){
    // map.present
    //     .getLayers()
    //     .forEach(function(l){
    //       // mess around with fading layer and then removing asynchronously.
    //       l.setStyle({'opacity':0});
    //     })
    if(map.hasLayer(map.present)){
      map.removeLayer(map.present);
    }
    if(new_map == group2015) {
      map.removeLayer(old_map);
      map.addLayer(modern_map);
    } else {
      map.removeLayer(modern_map);
      map.addLayer(old_map);
    }

    // Perhaps similarly mess with fade in. If fade out and in async, should dissolve.
    map.present = new_map;
    map.addLayer(new_map);
  }
}

//UGLY hack to set view to show map transition
trans_dec = $(".decade[value=1990]");
trans_year = $(".event[data='1994-hulme-guide-to-development']");
trans_pc = 100 * (trans_year[0].offsetTop - trans_dec[0].offsetTop) / trans_dec.height()
trans_dec.css('background', 'linear-gradient(to bottom, rgba(255,255,255,0) 0%,rgba(255,255,255,0.71) 65%,rgba(125,165,209,0.74)' + trans_pc + '%,rgba(125,165,209,1) 100%)')


function addLayer(layer, name, zIndex) {
  layer
  .setZIndex(zIndex)
  .addTo(map);

  // TODO: remove all this logic properly
  // // Create a simple layer switcher that
  // // toggles layers on and off.
  // var link = document.createElement('a');
  // link.href = '#';
  // link.className = 'active';
  // link.innerHTML = name;
  //
  // link.onclick = function(e) {
  //   e.preventDefault();
  //   e.stopPropagation();
  //
  //   if (map.hasLayer(layer)) {
  //     map.removeLayer(layer);
  //     this.className = '';
  //   } else {
  //     map.addLayer(layer);
  //     this.className = 'active';
  //   }
  // };
  //
  // layers.appendChild(link);
}
$('#timeline').mousedown(timeline_mousedown);

$('#tl-content').scroll(timeline_scroll)

$("li.event.item").each(function(){
  this.activate = function(){
    elem = this;
    window.location.hash = this.attributes.data.value;
    $(elem).addClass("active");
    setTimeout(function(){
      // check if class is still active rather than just scrolling through.
      if (elem.classList.contains("active")){
        var attrs = elem.attributes;
        // var lat = attrs['lat'].value;
        // var lng = attrs['lng'].value;
        var data = attrs['data'].value;

        popup_text(data);

        if(!elem.gjobject && overlay_res['events/' + data + '/']) {
          geojson_popup(data);
        } else if (elem.gjobject) {
          elem.gjobject.addTo(map);
        }
      }
    }, 500);
  }
  this.deactivate = function(){
    if(this.gjobject) {
      // remove geojson object layer
      map.removeLayer(this.gjobject);
    }
    $(this).removeClass("active");
    $("#popup").fadeOut();
  }
});

$("li.event").click(function(){
  // fixme: maths is wrong.
  var scroll = s_p_inv(this.offsetTop);
  $("#tl-content").animate({scrollTop:scroll});
})

$(document).ready(function(){
  // taking string from internet route. Sanitise thoroughly.
  var target = window.location.hash.replace(/([^a-zA-Z\-\d])/g, '');
  if(target != "") {
    $('[data="'+target+'"]')[0].click();
  }

  $("#ctl-close").click(function(){
    $("#popup").fadeOut();
  });
  $("#ctl-prev").click(function(){
    var ev_array = $(".event.item");
    var curr_idx = ev_array.index(selecta());
    if(curr_idx > 0) {
      $(ev_array[curr_idx - 1]).click();
    }
  });
  $("#ctl-next").click(function(){
    var ev_array = $(".event.item");
    var curr_idx = ev_array.index(selecta());
    if (curr_idx < ev_array.length - 1) {
      $(ev_array[curr_idx + 1]).click();
    }
  })
})

</script>

    </div>
  </body>
</html>
